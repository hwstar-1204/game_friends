<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket 매칭 테스트</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h1>WebSocket 매칭 테스트</h1>
<div>
    <label for="memberId">사용자 ID:</label>
    <input type="text" id="memberId" value="1" />
</div>
<button id="connectButton">연결하기</button>
<div id="result"></div>

<script>
    let stompClient = null;

    // 웹소켓에 연결된 후 호출되는 함수
    function onConnected() {
        const memberId = document.getElementById('memberId').value;
        console.log("웹소켓에 연결되었습니다.");

        // 매칭 요청 전송
        stompClient.send("/app/match", {}, memberId);
        // 매칭 결과 구독
        stompClient.subscribe(`/topic/match/${memberId}`, function (message) {
            const matchedUser = JSON.parse(message.body);
            document.getElementById('result').innerText += `매칭 성공: ${matchedUser.username}\n`;
        });
    }

    // 웹소켓 연결 실패 시 호출되는 함수
    function onError(error) {
        console.error("웹소켓 연결 실패: " + error);
    }

    // STOMP 클라이언트 연결 설정
    function connect() {
        const socket = new SockJS('/ws'); // 서버의 STOMP 엔드포인트로 연결
        stompClient = Stomp.over(socket);
        stompClient.connect({}, onConnected, onError);
    }

    // 버튼 클릭 시 연결 요청
    document.getElementById('connectButton').onclick = connect;
</script>
</body>
</html>